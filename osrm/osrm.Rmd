---
title: "Build a time distance matrix with OSRM"
author: "Nicolas LAMBERT"
date: "7/6/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

https://github.com/Project-OSRM/osrm-backend
https://rcarto.gitpages.huma-num.fr/materaccess/01_install_OSRM.html


## 1. Set up an instance of OSRM


https://rcarto.gitpages.huma-num.fr/materaccess/01_install_OSRM.html

<ins>1.1 Install Docker</ins><br/>


```
sudo apt update
sudo apt install apt-transport-https ca-certificates curl software-properties-common
curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add -
sudo add-apt-repository "deb [arch=amd64] https://download.docker.com/linux/ubuntu bionic stable"
sudo apt update
sudo apt install docker-ce
```

<ins>1.2 Increase swap memory (if needed)</ins>

- fallocate -l 64G /scripts/swap.swap
- chmod 600 /scripts/swap.swap
- mkswap /scripts/swap.swap
- swapon /scripts/swap.swap
- echo 20 > /proc/sys/vm/swappiness

<ins>1.3 Downloading OSM data</ins>

- mkdir france
- cd france
- wget http://download.geofabrik.de/europe/germany/berlin-latest.osm.pbf

<ins>1.4 Preparing data for OSRM</ins>

- docker run -t -v "${PWD}:/data" osrm/osrm-backend osrm-extract -p /opt/car.lua /data/france-latest.osm.pbf
- docker run -t -v "${PWD}:/data" osrm/osrm-backend osrm-partition /data/france-latest.osrm
- docker run -t -v "${PWD}:/data" osrm/osrm-backend osrm-customize /data/france-latest.osrm

<ins>Launch OSRM</ins>

- docker run --rm -t -i -p 5000:5000 -v "${PWD}:/data" osrm/osrm-backend:latest osrm-routed --algorithm mld --max-table-size 50000000 /data/france-latest.osrm

The OSRM instance will now be accessible at the server address 183.xx.xx.xxx on port 5000. Yolo! 


This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

## 2. Creation of a matrix using R language



```{r cars}
summary(cars)
```
